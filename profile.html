<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profil - Skillvio</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="navbar-brand">Skillvio</a>
            
            <div class="navbar-nav">
                <a href="index.html" class="nav-link">Ana Sayfa</a>
                <a href="jobs.html" class="nav-link">İş İlanları</a>
                <a href="blog.html" class="nav-link">Blog</a>
                <a href="education.html" class="nav-link">Eğitimler</a>
            </div>

            <div class="user-menu">
                <button class="user-button">
                    <span class="user-name"></span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="user-menu-items">
                    <a href="profile.html" class="user-menu-item">
                        <i class="fas fa-user"></i>
                        Profil
                    </a>
                    <a href="#" class="user-menu-item" onclick="clearAllData()">
                        <i class="fas fa-trash"></i>
                        Tüm Verileri Temizle
                    </a>
                    <a href="#" class="user-menu-item" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        Çıkış Yap
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Profile Section -->
    <section class="profile-section">
        <div class="container">
            <div class="profile-grid">
                <!-- Sol Taraf - Profil Fotoğrafı ve Temel Bilgiler -->
                <div class="profile-sidebar">
                    <div class="profile-photo-container">
                        <div class="profile-photo">
                            <img src="https://via.placeholder.com/200" alt="Profil Fotoğrafı" id="profilePhoto">
                            <div class="photo-overlay">
                                <label for="photoUpload" class="photo-upload-btn">
                                    <i class="fas fa-camera"></i>
                                    Fotoğraf Yükle
                                </label>
                                <input type="file" id="photoUpload" accept="image/*" style="display: none;">
                            </div>
                        </div>
                    </div>
                    <div class="profile-info">
                        <h2 id="profileName">Ad Soyad</h2>
                        <p id="profileTitle" class="profile-title">Unvan</p>
                        <div class="profile-social">
                            <a href="#" class="social-link" id="linkedinLink">
                                <i class="fab fa-linkedin"></i>
                            </a>
                            <a href="#" class="social-link" id="githubLink">
                                <i class="fab fa-github"></i>
                            </a>
                            <a href="#" class="social-link" id="portfolioLink">
                                <i class="fas fa-globe"></i>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Sağ Taraf - Profil Bilgileri Formu -->
                <div class="profile-content">
                    <div class="profile-form">
                        <h3>Kişisel Bilgiler</h3>
                        <form id="profileForm" onsubmit="saveProfile(event)">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Ad Soyad</label>
                                    <input type="text" class="form-control" name="fullName" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Unvan</label>
                                    <input type="text" class="form-control" name="title" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">E-posta</label>
                                    <input type="email" class="form-control" name="email" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Telefon</label>
                                    <input type="tel" class="form-control" name="phone">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Doğum Tarihi</label>
                                    <input type="date" class="form-control" name="birthDate">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Şehir</label>
                                    <input type="text" class="form-control" name="city">
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Hakkımda</label>
                                <textarea class="form-control" name="about" rows="4"></textarea>
                            </div>

                            <h3>Sosyal Medya & İletişim</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">LinkedIn</label>
                                    <input type="url" class="form-control" name="linkedin">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">GitHub</label>
                                    <input type="url" class="form-control" name="github">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Portfolio</label>
                                    <input type="url" class="form-control" name="portfolio">
                                </div>
                            </div>

                            <h3>Eğitim Bilgileri</h3>
                            <div id="educationContainer">
                                <div class="education-item">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">Okul</label>
                                            <input type="text" class="form-control" name="school[]">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Bölüm</label>
                                            <input type="text" class="form-control" name="department[]">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Başlangıç Tarihi</label>
                                            <input type="month" class="form-control" name="eduStartDate[]">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Bitiş Tarihi</label>
                                            <input type="month" class="form-control" name="eduEndDate[]">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline add-btn" onclick="addEducation()">
                                <i class="fas fa-plus"></i> Eğitim Ekle
                            </button>

                            <h3>İş Deneyimi</h3>
                            <div id="experienceContainer">
                                <div class="experience-item">
                                    <div class="form-grid">
                                        <div class="form-group">
                                            <label class="form-label">Şirket</label>
                                            <input type="text" class="form-control" name="company[]">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Pozisyon</label>
                                            <input type="text" class="form-control" name="position[]">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Başlangıç Tarihi</label>
                                            <input type="month" class="form-control" name="expStartDate[]">
                                        </div>
                                        <div class="form-group">
                                            <label class="form-label">Bitiş Tarihi</label>
                                            <input type="month" class="form-control" name="expEndDate[]">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">İş Tanımı</label>
                                        <textarea class="form-control" name="jobDescription[]" rows="3"></textarea>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-outline add-btn" onclick="addExperience()">
                                <i class="fas fa-plus"></i> Deneyim Ekle
                            </button>

                            <h3>Yetenekler</h3>
                            <div class="form-group">
                                <div class="skills-container" id="skillsContainer">
                                    <!-- Yetenekler buraya eklenecek -->
                                </div>
                                <div class="skill-input-container">
                                    <input type="text" class="form-control" id="skillInput" placeholder="Yetenek ekle ve Enter'a bas">
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">Değişiklikleri Kaydet</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Oturum kontrolü
        function checkSession() {
            const session = JSON.parse(sessionStorage.getItem('userSession'));
            if (!session || !session.email) {
                window.location.href = 'index.html';
                return null;
            }
            return session;
        }

        // Kullanıcı menüsünü güncelle
        function updateUserMenu() {
            const session = checkSession();
            if (session) {
                const userName = document.querySelector('.user-name');
                if (userName) {
                    userName.textContent = session.name;
                }
            }
        }

        // Profil fotoğrafı yükleme
        document.getElementById('photoUpload').addEventListener('change', function(e) {
            const session = checkSession();
            if (!session) return;

            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profilePhoto').src = e.target.result;
                    // Fotoğrafı kullanıcıya özel olarak kaydet
                    const profileKey = `userProfile_${session.email}`;
                    localStorage.setItem(`${profileKey}_image`, e.target.result);
                };
                reader.readAsDataURL(file);
            }
        });

        // Eğitim alanı ekleme
        function addEducation() {
            const container = document.getElementById('educationContainer');
            const template = container.children[0].cloneNode(true);
            template.querySelectorAll('input').forEach(input => input.value = '');
            container.appendChild(template);
        }

        // İş deneyimi ekleme
        function addExperience() {
            const container = document.getElementById('experienceContainer');
            const template = container.children[0].cloneNode(true);
            template.querySelectorAll('input, textarea').forEach(input => input.value = '');
            container.appendChild(template);
        }

        // Yetenek ekleme
        document.getElementById('skillInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                const skill = this.value.trim();
                if (skill) {
                    addSkill(skill);
                    this.value = '';
                }
            }
        });

        function addSkill(skill) {
            const container = document.getElementById('skillsContainer');
            const skillElement = document.createElement('div');
            skillElement.className = 'skill-tag';
            skillElement.innerHTML = `
                ${skill}
                <button type="button" class="skill-remove" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(skillElement);
        }

        // Profil formunu kaydetme
        function saveProfile(event) {
            event.preventDefault();
            const session = checkSession();
            if (!session) return;

            const form = event.target;
            const formData = new FormData(form);
            
            // Yetenekleri topla
            const skills = Array.from(document.querySelectorAll('.skill-tag'))
                .map(tag => tag.textContent.trim());

            // Profil verilerini oluştur
            const profileData = {
                fullName: formData.get('fullName'),
                title: formData.get('title'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                birthDate: formData.get('birthDate'),
                city: formData.get('city'),
                about: formData.get('about'),
                social: {
                    linkedin: formData.get('linkedin'),
                    github: formData.get('github'),
                    portfolio: formData.get('portfolio')
                },
                education: getEducationData(formData),
                experience: getExperienceData(formData),
                skills: skills
            };

            // Profil verilerini kullanıcıya özel olarak kaydet
            const profileKey = `userProfile_${session.email}`;
            localStorage.setItem(profileKey, JSON.stringify(profileData));
            
            // Başarılı mesajı göster
            alert('Profil başarıyla güncellendi!');
        }

        function getEducationData(formData) {
            const schools = formData.getAll('school[]');
            const departments = formData.getAll('department[]');
            const startDates = formData.getAll('eduStartDate[]');
            const endDates = formData.getAll('eduEndDate[]');

            return schools.map((school, index) => ({
                school,
                department: departments[index],
                startDate: startDates[index],
                endDate: endDates[index]
            })).filter(edu => edu.school || edu.department);
        }

        function getExperienceData(formData) {
            const companies = formData.getAll('company[]');
            const positions = formData.getAll('position[]');
            const startDates = formData.getAll('expStartDate[]');
            const endDates = formData.getAll('expEndDate[]');
            const descriptions = formData.getAll('jobDescription[]');

            return companies.map((company, index) => ({
                company,
                position: positions[index],
                startDate: startDates[index],
                endDate: endDates[index],
                description: descriptions[index]
            })).filter(exp => exp.company || exp.position);
        }

        // Çıkış yapma fonksiyonu
        function logout() {
            sessionStorage.removeItem('userSession');
            window.location.href = 'index.html';
        }

        // Tüm verileri temizleme fonksiyonu
        function clearAllData() {
            if (confirm('Tüm kayıtlı veriler silinecek. Emin misiniz?')) {
                localStorage.clear();
                sessionStorage.clear();
                alert('Tüm veriler temizlendi. Sayfa yenileniyor...');
                window.location.href = 'index.html';
            }
        }

        // Sayfa yüklendiğinde profil verilerini yükle
        document.addEventListener('DOMContentLoaded', function() {
            const session = checkSession();
            if (!session) return;

            updateUserMenu();

            // Kullanıcıya özel profil verilerini yükle
            const profileKey = `userProfile_${session.email}`;
            const profileData = JSON.parse(localStorage.getItem(profileKey));
            
            if (profileData) {
                // Form alanlarını doldur
                document.querySelector('[name="fullName"]').value = profileData.fullName || '';
                document.querySelector('[name="title"]').value = profileData.title || '';
                document.querySelector('[name="email"]').value = profileData.email || '';
                document.querySelector('[name="phone"]').value = profileData.phone || '';
                document.querySelector('[name="birthDate"]').value = profileData.birthDate || '';
                document.querySelector('[name="city"]').value = profileData.city || '';
                document.querySelector('[name="about"]').value = profileData.about || '';

                // Sosyal medya linklerini doldur
                if (profileData.social) {
                    document.querySelector('[name="linkedin"]').value = profileData.social.linkedin || '';
                    document.querySelector('[name="github"]').value = profileData.social.github || '';
                    document.querySelector('[name="portfolio"]').value = profileData.social.portfolio || '';
                }

                // Yetenekleri yükle
                if (profileData.skills) {
                    profileData.skills.forEach(skill => addSkill(skill));
                }

                // Profil başlığını güncelle
                document.getElementById('profileName').textContent = profileData.fullName || session.name;
                document.getElementById('profileTitle').textContent = profileData.title || '';

                // Profil fotoğrafını yükle
                const profileImage = localStorage.getItem(`${profileKey}_image`);
                if (profileImage) {
                    document.getElementById('profilePhoto').src = profileImage;
                }
            } else {
                // Eğer profil verisi yoksa, session'dan temel bilgileri al
                document.querySelector('[name="fullName"]').value = session.name || '';
                document.querySelector('[name="email"]').value = session.email || '';
                document.getElementById('profileName').textContent = session.name || '';
            }
        });
    </script>
</body>
</html> 